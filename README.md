# YABBI mobile SDK for iOS

## Оглавление

* [Общая схема взаимодействия](#общая-схема-взаимодействия)
* [Протокол обмена данными](#протокол-обмена-данными)
  * [Формат запроса](#формат-запроса)
  * [Формат ответа](#формат-ответа)
  * [Техническое описание](#техническое-описание)
* [Специфичные поля в RTB запросе](#специфичные-поля-в-rtb-запросе)
* [SDK API](#sdk-api)

## Общая схема взаимодействия

В приложениях креативы показываются в вебвью элементе.  
Концептуальные изменения в текущей схеме показа креативов не требуется.

SDK должно иметь методы и колбеки, отвечающие за процесс инициализации  
и оповещения пользователя о состоянии текущего показа.

Цепочка взаимодействия:
1. Пользователь создает аккаунт (или редактирует уже имеющийся) и добавляет сове приложение в свой аккаунт;
2. Пользователь вызывает метод инициализации в SDK, передавая свой идентификатор пользователя, полученный из веб интерфейса bestssp;
3. Пользователь вызывает метод загрузки креатива, передавая идентификатор своего приложения, формат и размеры будущего показа;
4. Пользователь вызывает метод показа уже загруженного креатива. В этот момент происходит показ баннера.


Если пользователь кликает на баннер, ссылка должна открываться в его браузере по умолчанию.  
Если в системе не удалось найти установленных браузеров - ссылка открывается в вебвью элементе с возможностью его закрытия (наличие крестика).

## Протокол обмена данными

#### Формат запроса:

```
{
    ifa       (string) // id юзера (может быть передана пустая строка, в случае когда его не удалось определить или ответ на определние не успел прийти до первого показа рекламы)
    pubID     (string) // id паблишера (UUID из пользовательского интерфейса системы)
    unitID    (string) // id рекламного места (UUID из пользовательского интерфейса системы)
    bundle    (string) // техническое название приложение
    userAgent (string) // user agent
    appName   (string) // человекочитаемое имя приложения
    geo       (object, nullable) { //обратите внимание, объект может быть null если информацию о гео получить не удалось
        latitude  (number) //широта
        longitude (number) //долгота
        precision (number) //точность, радиус в метрах
    }
}
```

#### Формат ответа:

```
{
   type         (int)    // 1 - баннер, 2 - видео, 3 - ревардед видео
   adm          (string) // валидный html/vast ответ, содержащий баннер
   closeTimeout (number) // время в миллисекундах, через котороя появится кнопка закрытия баннера
   width        (number) // ширина баннера, если высота или ширина баннера равны нулю - баннер адапативный, не используется в видео контейнере
   height       (number) // высота баннера, если высота или ширина баннера равны нулю - баннер адапативный, не используется в видео контейнере
   tracker: {
       view  (string) // срабатывает когда баннер был показан пользователю
       click (string) // срабатывает когда пользователь кликает по баннеру
   }
}
```

#### Техническое описание:

* Запрос выполняет SDK.  
* Ответ возвращает SSP.
* Все трекеры из набора трекеров в ответе (`tracker.EVENT_NAME`) вызываются непосредственно из SDK.
* Биллинг производится по факту поступления `view` ивента. Этот ивент считается фактом показа рекламы пользователю.

## Специфичные поля в RTB запросе

```
{
    site: {...}         // данное поле удаляется из запроса
    app: {
        name   (string) // человеческое название приложения
        bundle (string) // техническое название приложения
    }
}
```

## SDK API

Теперь API для SDK описывается в своём файле документации: [SDK_DOC](./documentation/SDK_DOC.md)
